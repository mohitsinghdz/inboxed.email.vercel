---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const schema = entry.data.schema ? {
  "@context": "https://schema.org",
  "@type": "Article",
  ...entry.data.schema,
  "author": {
    "@type": "Person",
    "name": entry.data.author,
    "jobTitle": "Founder, Inboxed"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Inboxed",
    "url": "https://inboxed.email"
  }
} : {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": entry.data.title,
  "description": entry.data.description,
  "datePublished": entry.data.datePublished,
  "dateModified": entry.data.dateModified,
  "author": {
    "@type": "Person",
    "name": entry.data.author,
    "jobTitle": "Founder, Inboxed"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Inboxed",
    "url": "https://inboxed.email"
  },
  "mainEntityOfPage": entry.data.canonical
};
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  canonical={entry.data.canonical}
  type="article"
  schemas={[schema]}
>
  <div class="container-custom py-32">
    <article class="max-w-3xl mx-auto">
      <div class="mb-12">
        <a href="/blog" class="font-mono text-sm uppercase tracking-widest text-mutedForeground hover:text-black mb-8 inline-block">&larr; Back to Blog</a>
        <h1 class="font-serif text-4xl md:text-6xl mb-6 leading-tight">
          {entry.data.title}
        </h1>
        <div class="font-mono text-sm text-mutedForeground flex flex-wrap items-center gap-x-4 gap-y-1">
          <time datetime={entry.data.datePublished}>{new Date(entry.data.datePublished).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
          <span>â€¢</span>
          <span>By <strong>{entry.data.author}</strong>, Founder of Inboxed</span>
        </div>
      </div>

      <div class="font-body text-xl leading-relaxed space-y-8 text-black/90 prose prose-xl max-w-none
        prose-headings:font-serif prose-headings:font-normal
        prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6
        prose-h3:text-2xl prose-h3:mt-8 prose-h3:mb-4
        prose-p:leading-relaxed
        prose-li:leading-relaxed
        prose-strong:font-bold
        prose-ul:list-disc prose-ul:pl-6 prose-ul:space-y-4
        prose-ol:list-decimal prose-ol:pl-6 prose-ol:space-y-4
        prose-a:text-black prose-a:underline prose-a:decoration-1 prose-a:underline-offset-4 hover:prose-a:decoration-2
        prose-blockquote:border-l-4 prose-blockquote:border-black prose-blockquote:pl-6 prose-blockquote:italic">
        <Content />
      </div>

      <div class="mt-20 pt-12 border-t border-black/10">
        <p class="font-mono text-sm text-mutedForeground mb-6">Ready to try privacy-first email?</p>
        <a href="/" class="btn-primary inline-block">Download Inboxed Free</a>
      </div>
    </article>
  </div>
</BaseLayout>
